#################################################
# Package Light - Livingroom
#################################################

livingroom_light_pack:

  automation:

    - alias: "Кнопка Xiaomi в Гостиной"
      id: 20b084dc-0393-44e3-897d-3cec019647a1
      mode: queued
      max: 5
      max_exceeded: silent
      trigger:
        - platform: event
          event_type: zha_event
          event_data:
            device_ieee: "00:15:8d:00:03:5a:9b:c5"
            command: "click"
          id: "click"
        - platform: event
          event_type: zha_event
          event_data:
            device_ieee: "00:15:8d:00:03:5a:9b:c5"
            command: "hold"
          id: "hold"
      action:
        choose:
          - alias: Action Click
            conditions:
              - condition: trigger
                id: "click"
            sequence:
              choose:
                - alias: Single click
                  conditions: "{{ trigger.event.data.args.click_type == 'single' }}"
                  sequence:
                    - service: light.toggle
                      data:
                        entity_id: light.sonoff_1000ab3c28
                - alias: Double click
                  conditions: "{{ trigger.event.data.args.click_type == 'double' }}"
                  sequence:
                    - service: light.toggle
                      data:
                        entity_id: light.sonoff_1000f3035d
          - alias: Action Hold
            conditions:
              - condition: trigger
                id: "hold"
            sequence:
              - service: light.toggle
                data:
                  entity_id: light.gostinaia_podsvetka_na_okne

    - alias: "Подсветка на окне в Гостиной"
      id: 32c18d2f-1d01-4458-b5e2-05048b73a3d7
      trigger:
        - platform: numeric_state
          entity_id: sensor.lumi_lumi_sen_ill_mgl01_illuminance
          below: 550
          for: "00:10:00"
          id: "dark"
        - platform: numeric_state
          entity_id: sensor.lumi_lumi_sen_ill_mgl01_illuminance
          above: 550
          for: "00:10:00"
          id: "lightly"
        - platform: time
          at: "00:30:00"
          id: "time"
      action:
        choose:
          - alias: Darkens (Turn On)
            conditions:
              - condition: trigger
                id: "dark"
            sequence:
              - condition: state
                entity_id: light.gostinaia_podsvetka_na_okne
                state: "off"
              - service: light.turn_on
                data:
                  entity_id: light.gostinaia_podsvetka_na_okne
          - alias: Brightens (Turn Off)
            conditions:
              - condition: or
                conditions:
                  - condition: trigger
                    id: "lightly"
                  - condition: trigger
                    id: "time"
            sequence:
              - condition: state
                entity_id: light.gostinaia_podsvetka_na_okne
                state: "on"
              - service: light.turn_off
                data:
                  entity_id: light.gostinaia_podsvetka_na_okne

    - alias: "Пульт IKEA в Гостиной"
      id: 94f03734-3e9f-47cd-80c6-af9f37236974
      mode: restart
      trigger:
        - platform: event
          event_type: zha_event
          event_data:
            device_ieee: "d0:cf:5e:ff:fe:33:93:f6"
      action:
        choose:
          - alias: toggle
            conditions: "{{ trigger.event.data.command == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: light.ikea_e27_level_light_color_on_off
          - alias: step_with_on_off
            conditions: "{{ trigger.event.data.command == 'step_with_on_off' }}"
            sequence:
              - service: light.turn_on
                data:
                  brightness_step: 5
                target:
                  entity_id: light.ikea_e27_level_light_color_on_off
          - alias: move_with_on_off
            conditions: "{{ trigger.event.data.command == 'move_with_on_off' }}"
            sequence:
              repeat:
                until: "{{ wait.trigger is not none }}"
                sequence:
                  - service: light.turn_on
                    data:
                      brightness_step: 5
                    target:
                      entity_id: light.ikea_e27_level_light_color_on_off
                  - wait_for_trigger:
                      platform: event
                      event_type: zha_event
                      event_data:
                        device_ieee: "{{ trigger.event.data.device_ieee }}"
                        command: "stop"
                    timeout:
                      milliseconds: 200
          - alias: step
            conditions: "{{ trigger.event.data.command == 'step' }}"
            sequence:
              - service: light.turn_on
                data:
                  brightness_step: -5
                target:
                  entity_id: light.ikea_e27_level_light_color_on_off
          - alias: move
            conditions: "{{ trigger.event.data.command == 'move' }}"
            sequence:
              repeat:
                until: "{{ wait.trigger is not none }}"
                sequence:
                  - service: light.turn_on
                    data:
                      brightness_step: -5
                    target:
                      entity_id: light.ikea_e27_level_light_color_on_off
                  - wait_for_trigger:
                      platform: event
                      event_type: zha_event
                      event_data:
                        device_ieee: "{{ trigger.event.data.device_ieee }}"
                        command: "stop"
                    timeout:
                      milliseconds: 200