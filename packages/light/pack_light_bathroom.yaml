#################################################
# Package Light - Bathroom
#################################################

bathroom_light_pack:

  timer:

    bathroom_presence:
      duration: "00:03:00"

  automation:

    - alias: "Кнопка Xiaomi в Ванной"
      id: 12e5ed24-2543-4bc8-978a-434dc466d818
      mode: queued
      max: 5
      max_exceeded: silent
      trigger:
        - platform: event
          event_type: zha_event
          event_data:
            device_ieee: "00:15:8d:00:03:d1:77:62"
            command: "click"
          id: "click"
#        - platform: event
#          event_type: zha_event
#          event_data:
#            device_ieee: "00:15:8d:00:03:d1:77:62"
#            command: "hold"
#          id: "hold"
      action:
        choose:
          - alias: Action Click
            conditions:
              - condition: trigger
                id: "click"
            sequence:
              choose:
                - alias: Single click
                  conditions: "{{ trigger.event.data.args.click_type == 'single' }}"
                  sequence:
                    - service: light.toggle
                      data:
                        entity_id: light.sonoff_zbmini_04_on_off
                    - delay: "00:00:02"
                    - choose:
                      - alias: Light On
                        conditions: "{{ is_state('light.sonoff_zbmini_04_on_off', 'on') }}"
                        sequence:
                          - service: fan.turn_on
                            target:
                              entity_id: fan.bathroom_extractor
                      - alias: Light Off
                        conditions: "{{ is_state('light.sonoff_zbmini_04_on_off', 'off') }}"
                        sequence:
                          - service: fan.turn_off
                            target:
                              entity_id: fan.bathroom_extractor
                - alias: Double click
                  conditions: "{{ trigger.event.data.args.click_type == 'double' }}"
                  sequence:
                    - service: fan.toggle
                      target:
                        entity_id: fan.bathroom_extractor
#          - alias: Action Hold
#            conditions:
#              - condition: trigger
#                id: "hold"
#            sequence:
#              - service: light.toggle
#                data:
#                  entity_id:

    - alias: "Геркон в Ванной"
      id: 5742486a-8130-4315-91a6-cb25cd5e39fb
      mode: queued
      max: 5
      max_exceeded: silent
      trigger:
        - platform: state
          entity_id: binary_sensor.lumi_lumi_sensor_magnet_on_off
          id: "magnet"
      action:
        choose:
          - alias: Door Opens
            conditions: "{{ trigger.from_state.state == 'off' and trigger.to_state.state == 'on' }}"
            sequence:
              - choose:
                - alias: Light Off
                  conditions: "{{ is_state('light.sonoff_zbmini_04_on_off', 'off') }}"
                  sequence:
                    - service: light.turn_on
                      target:
                        entity_id: light.sonoff_zbmini_04_on_off
              - choose:
                - alias: Fan Off
                  conditions: "{{ is_state('fan.bathroom_extractor','off') }}"
                  sequence:
#                     - delay: "00:00:02"
                    - service: fan.turn_on
                      target:
                        entity_id: fan.bathroom_extractor