#################################################
# Miscellaneous template sensors
#################################################
- sensor:

  - name: ym_dom_dacha_hr
    state: >
      {{ as_datetime(states('sensor.do_dachi') | int(0) * 60).strftime('%-H ч. %M мин.') }}

  - name: ym_dacha_dom_hr
    state: >
      {{ as_datetime(states('sensor.do_doma_ot_dachi') | int(0) * 60).strftime('%-H ч. %M мин.') }}

#  - name: Xiaomi Gas Density
#    state: "{{ state_attr('sensor.0x158d000413b210_gas_density', 'Density') }}"

  - name: Entrance Door Status
    state: >
      {% if is_state('binary_sensor.0x158d00031c790f_contact', "on") %}Открыта
      {% elif is_state('binary_sensor.0x158d00031c790f_contact', "off") %}Закрыта
      {% else %}Unavailable
      {% endif %}

  - name: Local Pressure mmhg
    unit_of_measurement: mmHg
    state: >
      {% set pressure = states('sensor.0x158d0003230618_pressure') | float(default=-1) %}
      {% if pressure != -1 and (((states('sensor.0x158d0003230618_pressure') | float(0)) / 1.333) | round(2)) > 500 %}
      {{ ((states('sensor.0x158d0003230618_pressure') | float(0)) / 1.333) | round(2) }}
      {% else %}
      {{ states('sensor.local_pressure_mmhg') }}
      {% endif %}

  - name: OpenWeatherMap Moskva Danilovskii Pressure mmhg
    unit_of_measurement: mmHg
    state: >
      {% set pressure = states('sensor.openweathermap_moskva_danilovskii_pressure') | float(default=-1) %}
      {% if pressure != -1 and (((states('sensor.openweathermap_moskva_danilovskii_pressure') | float(0)) / 1.333) | round(2)) > 500 %}
      {{ ((states('sensor.openweathermap_moskva_danilovskii_pressure') | float(0)) / 1.333) | round(2) }}
      {% else %}
      {{ states('sensor.openweathermap_moskva_danilovskii_pressure_mmhg') }}
      {% endif %}

  - name: OpenWeatherMap Stupino Nivki-2 Pressure mmhg
    unit_of_measurement: mmHg
    state: >
      {% set pressure = states('sensor.openweathermap_stupino_nivki_2_pressure') | float(default=-1) %}
      {% if pressure != -1 and (((states('sensor.openweathermap_stupino_nivki_2_pressure') | float(0)) / 1.333) | round(2)) > 500 %}
      {{ ((states('sensor.openweathermap_stupino_nivki_2_pressure') | float(0)) / 1.333) | round(2) }}
      {% else %}
      {{ states('sensor.openweathermap_stupino_nivki_2_pressure_mmhg') }}
      {% endif %}